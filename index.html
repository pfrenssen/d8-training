<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>reveal.js â€“ The HTML Presentation Framework</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/solarized.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section data-background="#ffffff">
          <h1>D8 Configuration management</h1>
          <p>
            <small><a href="https://drupal.org/u/pfrenssen">Pieter Frenssen</a> / <a href="http://twitter.com/pfrenssen">@pfrenssen</a></small>
          </p>
          <img src="./one-agency.png" style="width: 100px; height: 100px; border: none; box-shadow: none;">
        </section>

        <section>
          <h2>Slides</h2>
          <p><a href="https://github.com/pfrenssen/d8-training">https://github.com/pfrenssen/d8-training</a></p>
          <p>branch: d8-cmi</p>
        </section>

        <section>
          <h2>History</h2>
          <ul>
            <li>Variables</li>
            <li>Features</li>
            <li>CMI</li>
            <li>Configuration System</li>
          </ul>
        </section>

        <section>
          <h2>Using the UI</h2>
          <ul>
            <li>Config &gt; Configuration Synchronisation</li>
            <li>Import, Export, Sync</li>
            <li>Single items or full archive</li>
            <li>Allows to quickly copy/paste</li>
            <li>Allows to review changes</li>
          </ul>
        </section>

        <section>
          <h2>Config files</h2>
          <p>system.site.yml</p>
          <pre><code data-trim contenteditable>
uuid: bbd7689e-0acd-44d3-ba0f-158102d117dd
name: My Site
mail: admin@example.com
slogan: 'My slogan'
page:
  403: '/my/403/page'
  404: '/my/404/page'
  front: /user/login
admin_compact_mode: false
weight_select_max: 100
langcode: en
default_langcode: en
          </code></pre>
        </section>

        <section>
          <h2>The active store</h2>
          <ul>
            <li>Currently active configuration</li>
            <li>Defaults to SQL storage</li>
            <li>Don't mess with it</li>
          </ul>
        </section>

        <section>
          <h2>Active store is configurable</h2>
          <ul>
            <li>SQL storage</li>
            <li>File storage</li>
            <li>MongoDB</li>
            <li>Redis</li>
          </ul>
        </section>

        <section>
          <h2>The sync folder</h2>
          <ul>
            <li>sites/default/files/config_HASH</li>
            <li>Can be changed in settings.php</li>
          </ul>
        </section>

        <section>
          <h2>Simple config</h2>
          <ul>
            <li>Similar to D7</li>
            <li>Replaces variable_get/set()</li>
            <li>Uses basic data types</li>
          </ul>
        </section>

        <section data-background="#F8FCC1">
          <h3>Example of simple config</h3>
          <p>config/install/mymodule.settings.yml</p>
          <pre><code data-trim contenteditable>
promo_active: false
highlights:
  show: true
  count: 3
          </code></pre>
        </section>

        <section>
          <h2>Config schema</h2>
          <ul>
            <li>Stores metadata about config items</li>
            <li>Type, label, translatable</li>
            <li>Very important for multilingual</li>
          </ul>
          <p><a href="https://www.drupal.org/node/1905070">Configuration schema documentation</a></p>
        </section>

        <section data-background="#F8FCC1">
          <h3>Example config schema</h3>
          <p>config/install/mymodule.schema.yml</p>
          <pre><code data-trim contenteditable>
mymodule.settings:
  type: config_object
  label: 'Settings for my module'
  mapping:
    promo_active:
      type: boolean
      label: 'If we are running a promotion'
    highlights:
      type: mapping
      label: 'Configuration for highlighted products'
      mapping:
        show_highlighted_products:
          type: boolean
          label: 'Show highlighted products'
        highlights_count:
          type: integer
          label: 'The number of highlighted products'
          </code></pre>
        </section>

        <section data-background="#F8FCC1">
          <p>Reading configuration</p>
          <pre><code data-trim contenteditable>
// This returns immutable (read-only) config.
$config = \Drupal::config('mymodule.settings');
$promo  = $config->get('promo_active');
$show   = $config->get('highlights.show');
$count  = $config->get('highlights.count');
          </code></pre>
        </section>

        <section data-background="#F8FCC1">
          <p>Writing configuration</p>
          <pre><code data-trim contenteditable>
// This returns mutable (editable) config.
$config = \Drupal::service('config.factory')->getEditable('mymodule.settings');
$config->set('promo_active', TRUE);
$config->set('highlights.show', FALSE);
$config->set('highlights.count', 5);
$config->save();

// It's chainable.
\Drupal::service('config.factory')
  ->getEditable('mymodule.settings')
  ->set('highlights.show', FALSE)
  ->set('highlights.count', 5)
  ->save();
          </code></pre>
        </section>

        <section data-background="#F8FCC1">
          <p>Deleting configuration</p>
          <pre><code data-trim contenteditable>
// Get a mutable instance of the configuration set.
$config = \Drupal::service('config.factory')->getEditable('mymodule.settings');
// Delete a single entry.
$config->clear('promo_active');
$config->save();

// Delete a full configuration set.
\Drupal::service('config.factory')
  ->getEditable('mymodule.settings')
  ->delete();
          </code></pre>
        </section>

        <section data-background="#F8FCC1">
          <h3>ConfigFormBase</h3>
          <pre><code data-trim contenteditable>
namespace Drupal\mymodule\Form;

use Drupal\Core\Form\ConfigFormBase;
use Drupal\Core\Form\FormStateInterface;

class MyModuleSettingsForm extends ConfigFormBase {

  public function getFormID() {
    return 'mymodule_settings';
  }

  protected function getEditableConfigNames() {
    return ['mymodule.settings'];
  }

  public function buildForm(array $form, FormStateInterface $form_state) {
    $config = $this->config('mymodule.settings');

    $form['promo_active'] = array(
      '#type' => 'checkbox',
      '#title' => t('Promo active'),
      '#default_value' => $config->get('promo_active'),
    );

    return parent::buildForm($form, $form_state);
  }

  public function submitForm(array &$form, FormStateInterface $form_state) {
    $this->config('mymodule.settings')
      ->set('promo_active', $form_state->getValue('promo_active'))
      ->save();

    parent::submitForm($form, $form_state);
  }

}
          </code></pre>
        </section>

        <section>
          <h3>Config entities</h3>
          <ul>
            <li>Complex configuration</li>
            <li>Allows to create 0 or more items</li>
            <li>Examples: content types, views</li>
          </ul>
        </section>

        <section>
          <h2>Default config</h2>
          <ul>
            <li>Sites own configuration, not modules</li>
            <li>Stored in config/install</li>
            <li>Is imported on module install</li>
            <li>Changes require update hooks</li>
            <li>Solves reverting to config-in-code</li>
          </ul>
        </section>

        <section>
          <h2>Optional config</h2>
          <ul>
            <li>Stored in config/optional</li>
            <li>Config for optional modules</li>
          </ul>
        </section>

        <section>
          <h3>Deploying</h3>
          <ul>
            <li>Between instances of the same site</li>
            <li>Matching UUIDs</li>
            <li>Flexible workflows</li>
          </ul>
        </section>

        <section>
          <h2>Workflows</h2>
          <ul>
            <li>UI</li>
            <li>Drush</li>
            <li>Filesystem</li>
          </ul>
        </section>

        <section>
          <h2>UI workflow</h2>
          <ul>
            <li>Export full configuration</li>
            <li>Upload archive</li>
            <li>Import configuration</li>
            <li>Review changes</li>
          </ul>
        </section>

        <section>
          <h2>Drush workflow</h2>
          <ul>
            <li>drush config-export</li>
            <li>Sync config folder with git</li>
            <li>drush config-import</li>
          </ul>
        </section>

        <section>
          <h2>Filesystem workflow</h2>
          <ul>
            <li>Active store in filesystem</li>
            <li>Activate in settings.php</li>
            <li>Sync between 'active' and 'staging' folders</li>
            <li>Import via UI</li>
          </ul>
        </section>

        <section>
          <h2>Dependencies</h2>
          <ul>
            <li>Config can declare dependencies</li>
            <li>Example: Remove blocks when Views is uninstalled</li>
          </ul>
        </section>

        <section>
          <h2>Overriding config</h2>
          <ul>
            <li>global $config</li>
            <li>Defined in settings.php</li>
            <li>Separate layer</li>
            <li>Not visible in forms</li>
            <li>ConfigFactoryOverrideInterface</li>
          </ul>
        </section>

        <section data-background="#F8FCC1">
          <h3>Overridden config</h3>
          <p>settings.php</p>
          <pre><code data-trim contenteditable>
$config['mymodule.settings']['promo_active'] = TRUE;
          </code></pre>
          <pre><code data-trim contenteditable>
// Get the overridden value by default.
$active = \Drupal::config('mymodule.settings')->get('promo_active');

// Get the value without overrides.
$original = \Drupal::config('mymodule.settings')->getOriginal('promo_active');

// Mutable config is never overridden.
$mutable = \Drupal::configFactory()->getEditable('mymodule.settings')->get('promo_active');
          </code></pre>
        </section>

        <section>
          <h2>Contrib modules</h2>
        </section>

        <section>
          <h2>Features</h2>
          <ul>
            <li>Back to original use case</li>
            <li>Bundling of reusable functionality</li>
            <li>Much lighter in D8</li>
          </ul>
        </section>

        <section>
          <h3>Configuration Development</h3>
          <p><a href="https://www.drupal.org/project/config_devel">https://www.drupal.org/project/config_devel</a></p>
          <ul>
            <li>Export config into YAML files</li>
            <li>"Features" replacement</li>
            <li>Update config with drush</li>
          </ul>
        </section>

        <section>
          <h3>Configuration inspector</h3>
          <p><a href="https://www.drupal.org/project/config_inspector">https://www.drupal.org/project/config_inspector</a></p>
          <ul>
            <li>Inspect config schemas</li>
            <li>Compare data with schemas</li>
          </ul>
        </section>

        <section>
          <h3>Configuration Read-only mode</h3>
          <p><a href="https://www.drupal.org/project/config_readonly">https://www.drupal.org/project/config_readonly</a></p>
          <ul>
            <li>Locks changing config through UI</li>
            <li>Enable on production</li>
          </ul>
        </section>

        <section>
          <h3>Configuration Tools</h3>
          <p><a href="https://www.drupal.org/project/config_tools">https://www.drupal.org/project/config_tools</a></p>
          <ul>
            <li>Dump active config to files</li>
            <li>Auto-commit config changes</li>
          </ul>
        </section>

        <section>
          <h3>Configuration Update Manager</h3>
          <p><a href="https://www.drupal.org/project/config_update">https://www.drupal.org/project/config_update</a></p>
          <ul>
            <li>Advanced importing of config</li>
            <li>Inspect and revert changes</li>
          </ul>
        </section>

        <section>
          <h2>Questions?</h2>
        </section>

        <section>
          <h3>Exercise: simple config</h3>
          <ul>
            <li>Build a form with a checkbox</li>
            <li>Store the value of the checkbox in simple config</li>
            <li>If the module is enabled, the checkbox defaults to "checked"</li>
          </ul>
        </section>

        <section>
          <h3>Exercise: simple config</h3>
          <p>Tips:</p>
          <ul>
            <li>Use ConfigFormBase</li>
            <li>Example: SiteMaintenanceModeForm</li>
            <li>Don't forget to define a route</li>
          </ul>
        </section>

        <section>
          <h3>Exercise: config entity</h3>
          <ul>
            <li>Create a "Promo" config entity</li>
            <li>Store the name of the promo</li>
            <li>Store the discount</li>
            <li>Edit forms</li>
            <li>Overview</li>
          </ul>
          <p><a href="https://www.drupal.org/node/1809494">Creating a config entity type</a></p>
        </section>

        <section>
          <h2>Documentation</h2>
          <ul>
            <li><a href="https://www.drupal.org/documentation/administer/config">Managing configuration in D8</a></li>
            <li><a href="https://api.drupal.org/api/drupal/core%21core.api.php/group/config_api/8">Configuration API</a></li>
            <li><a href="https://www.drupal.org/node/1809490">Simple Configuration API</a></li>
            <li><a href="https://www.chapterthree.com//blog/principles-configuration-management-part-one">Principles of configuration management</a></li>
            <li><a href="https://www.drupal.org/files/ConfigSchemaCheatSheet1.5.pdf">Config schema cheatsheet (PDF)</a></li>
          </ul>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        width: 1280,
        height: 800,

        transition: 'convex', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
