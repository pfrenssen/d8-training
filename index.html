<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>reveal.js â€“ The HTML Presentation Framework</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/solarized.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section data-background="#ffffff">
          <h1>RESTful web services</h1>
          <p>
            <small><a href="https://drupal.org/u/pfrenssen">Pieter Frenssen</a> / <a href="http://twitter.com/pfrenssen">@pfrenssen</a></small>
          </p>
          <img src="./one-agency.png" style="width: 100px; height: 100px; border: none; box-shadow: none;">
        </section>

        <section>
          <h2>Slides</h2>
          <p><a href="https://github.com/pfrenssen/d8-training">https://github.com/pfrenssen/d8-training</a></p>
          <p>branch: rest-api</p>
        </section>

        <section>
          <h2>REST?</h2>
          <h3>REpresentational</h3>
          <h3>State</h3>
          <h3>Transfer</h3>
        </section>

        <section>
          <h2>What is REST?</h2>
          <ul>
            <li>Software architecture</li>
            <li>Resource based (using URIs)</li>
            <li>Communication over HTTP</li>
            <li>Introduced by Roy Fielding in 2000</li>
          </ul>
        </section>

        <section>
          <h2>What is REST?</h2>
          <h3>The 6 constraints</h3>
          <ul>
            <li>Client-server</li>
            <li>Stateless</li>
            <li>Cache</li>
            <li>Uniform interface</li>
            <li>Layered system</li>
            <li>Code-on-demand</li>
          </ul>
          <p><a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm">http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm</a></p>
        </section>

        <section>
          <h2>Why use REST?</h2>
          <ul>
            <li>Standard CRUD implementation</li>
            <li>Easy to use</li>
            <li>Widely supported</li>
            <li>Built in to popular JS frameworks</li>
          </ul>
        </section>

        <section>
          <h2>CRUD over HTTP</h2>
          <ul>
            <li>Create: POST</li>
            <li>Read: GET</li>
            <li>Update: PATCH (or PUT)</li>
            <li>Delete: DELETE</li>
          </ul>
        </section>

        <section>
          <h2>REST API first look: drupal.org</h2>
          <ul>
            <li>https://www.drupal.org/drupalorg/api</li>
            <li>Exposes projects, issues, users, nodes, comments, ...</li>
            <li>Read-only</li>
            <li>Anonymous access (fair use)</li>
            <li>Returns data in JSON and XML formats</li>
            <li>Supports pagination and sorting</li>
            <li>Built in Drupal 7 with the RESTful Web Services module</li>
          </ul>
        </section>

        <section>
          <h3>An example request</h3>
          <p><a href="https://www.drupal.org/api-d7/user.json?field_country=Belgium&sort=uid&limit=10">https://www.drupal.org/api-d7/user.json?field_country=Belgium&sort=uid&limit=10</a></p>
          <ul>
            <li>A JSON object is returned</li>
            <li>Contains pagination data and a list of users</li>
            <li>User objects contain many fields</li>
            <li>Can be filtered and sorted by field</li>
            <li>Do all fields make sense?</li>
          </ul>
        </section>

        <section>
          <h2>REST client</h2>
          <ul>
            <li>Desktop application</li>
            <li>Browser plugin</li>
            <li>Command line client</li>
            <li>Curl</li>
          </ul>
        </section>

        <section>
          <h2>Doing requests with Curl</h2>
          <ul>
            <li>Powerful CLI data transfer tool</li>
            <li>Available on all platforms</li>
            <li>Does a lot more than just HTTP</li>
            <li>Good for doing quick tests</li>
          </ul>
        </section>

        <section>
          <h3>GET Example</h3>
          <pre><code class="hljs">
    $ curl 'https://www.drupal.org/api-d7/node.json?limit=1'
          </code></pre>
          <p>Tip: add the --include flag to display HTTP headers</p>
        </section>

        <section>
          <h3>POST Example</h3>
          <pre><code class="hljs">
    $ curl \
      --header "Content-Type: application/json" \
      --request POST \
      --data-binary '{"username":"pfrenssen","password":"hunter2"}' \
      http://my.domain/api/login
          </code></pre>
        </section>

        <section>
          <h3>PATCH Example</h3>
          <pre><code class="hljs">
    $ curl \
      --header 'Content-type: application/hal+json' \
      --header 'X-CSRF-Token: YmFH42rZPtRLzl5ZrA5GyKKlskqqWsJQEcme0yWR888' \
      --request PATCH \
      --user pfrenssen:hunter2 \
      --data-binary '{"title":[{"value":"Updated node title"}]}' \
      http://my.domain/node/123?_format=hal_json
          </code></pre>
          <p>Tip: get a token from /rest/session/token</p>
        </section>

        <section>
          <h3>DELETE Example</h3>
          <pre><code class="hljs">
    $ curl \
      --header 'X-CSRF-Token: YmFH42rZPtRLzl5ZrA5GyKKlskqqWsJQEcme0yWR888' \
      --request DELETE \
      --user pfrenssen:hunter2 \
      http://my.domain/node/123?_format=hal_json
          </code></pre>
          <p>Tip: get a token from /rest/session/token</p>
        </section>

        <section>
          <h2>Browser plugins</h2>
          <h3>Postman for Chromium</h3>
          <p><a href="https://www.getpostman.com/">https://www.getpostman.com/</a></p>
          <p><img src="postman.png" /></p>
        </section>

        <section>
          <h3>HttpRequester for Firefox</h3>
          <p><a href="https://addons.mozilla.org/firefox/addon/httprequester">https://addons.mozilla.org/firefox/addon/httprequester</a></p>
          <p><img src="httprequester.png" /></p>
        </section>

        <section>
          <h3>Browser plugin for viewing JSON</h3>
          <ul>
            <li>Chromium: <a href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa">JSON Formatter</a></li>
            <li>Firefox: <a href="https://addons.mozilla.org/en-US/firefox/addon/jsonview/?src=search">JSONView</a></li>
          </ul>
        </section>
          <h3>Postman for Chromium</h3>
          <p><a href="https://www.getpostman.com/">https://www.getpostman.com/</a></p>
          <p><img src="postman.png" /></p>
        </section>

        <section>
          <h3>HttpRequester for Firefox</h3>
          <p><a href="https://addons.mozilla.org/firefox/addon/httprequester">https://addons.mozilla.org/firefox/addon/httprequester</a></p>
          <p><img src="httprequester.png" /></p>
        </section>

        <section>
          <h3>Browser plugin for viewing JSON</h3>
          <ul>
            <li>Chromium: <a href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa">JSON Formatter</a></li>
            <li>Firefox: <a href="https://addons.mozilla.org/en-US/firefox/addon/jsonview/?src=search">JSONView</a></li>
          </ul>
        </section>

        <section>
          <h2>Stuff you need</h2>
          <ul>
            <li>Drupal 8</li>
            <li>Drush</li>
            <li>Console</li>
            <li>REST client</li>
          </ul>
        </section>

        <section>
          <h2>Drupal 8</h2>
          <ul>
            <li>Use standard profile</li>
            <li>Enable the REST module</li>
            <li>Install <a href="https://www.drupal.org/project/restui">REST UI</a> contrib module</li>
          </ul>
        </section>

        <section>
          <h2>Drush</h2>
          <p><a href="https://github.com/drush-ops/drush">https://github.com/drush-ops/drush</a></p>
        </section>

        <section>
          <h2>Console</h2>
          <p><a href="https://drupalconsole.com/">https://drupalconsole.com/</a></p>
        </section>


        <section>
          <h2>Exercise: Consuming a REST service</h2>
          <ul>
            <li>Use the Drupal.org REST API</li>
            <li>Retrieve 5 change records with Guzzle</li>
            <li>Display in a block</li>
          </ul>
        </section>

        <section>
          <h3>Create a module with Drupal Console</h3>
          <pre><code class="hljs">
      $ drupal generate:module

      Enter the new module name:
      > Change records

      Enter module description [My Awesome Module]:
      > Displays change records from drupal.org.

      Do you confirm generation? (yes/no) [yes]:
      > yes

      Generated or updated files
       1 - modules/custom/change_records/change_records.info.yml
       2 - modules/custom/change_records/composer.json
          </code></pre>
          <p>(all default options are omitted)</p>
        </section>

        <section>
          <h3>Create a block part 1</h3>
          <pre><code class="hljs">
      $ drupal generate:plugin:block

      Enter the module name [devel]:
      > change_records

      Plugin class name [DefaultBlock]:
      > ChangeRecordsBlock

      Do you want to load services from the container (yes/no) [no]:
      > yes

      Enter your service [ ]:
      > http_client
          </code></pre>
        </section>

        <section>
          <h3>Create a block part 2</h3>
          <pre><code class="hljs">
      Do you want to generate a form structure? (yes/no) [yes]:
      > yes

      Type [ ]:
      > number

      Input label:
      > Number of change records to show

      Input machine name [number_of_change_records_to_show]:
      > limit

      Default value [ ]:
      > 5
          </code></pre>
        </section>

        <section>
          <h3>Create a block part 3</h3>
          <pre><code class="hljs">
      Do you confirm generation? (yes/no) [yes]:
      > yes

      Generated or updated files
       1 - modules/custom/change_records/src/Plugin/Block/ChangeRecordsBlock.php

      Rebuilding cache(s), wait a moment please.
      [OK] Done clearing cache(s).
          </code></pre>
        </section>

        <section>
          <h3>Requesting data from the REST API</h3>
          <p>src/Plugin/Block/ChangeRecordsBlock.php</p>
          <pre><code class="hljs">
  public function build() {
    $options = [
      'query' => [
        'type' => 'changenotice',
        'limit' => $this->configuration['limit'],
        'status' => 1,
        'sort' => 'created',
        'direction' => 'DESC',
      ],
    ];
    $result = $this->http_client->get('https://www.drupal.org/api-d7/node.json', $options);
    $change_records = json_decode($result->getBody())->list;
    // ...
  }
          </code></pre>
        </section>

        <section>
          <h3>Requesting data from the REST API</h3>
          <p>src/Plugin/Block/ChangeRecordsBlock.php</p>
          <pre><code class="hljs">
  public function build() {
    // ...
    $items = [];
    foreach ($change_records as $change_record) {
      $items[] = [
        '#type' => 'link',
        '#title' => $change_record->title,
        '#url' => Url::fromUri($change_record->url),
      ];
    }
    return [
      '#theme' => 'item_list',
      '#items' => $items,
      '#list_type' => 'ol',
    ];
  }
          </code></pre>
        </section>

        <section>
          <h3>Modeling REST data as entities</h3>
          <ul>
            <li>json_decode() results in a plain object (meh)</li>
            <li>Entities are the ideal match in Drupal</li>
            <li>Integrates well with everything</li>
            <li>Local caching</li>
            <li>Importing / exporting</li>
            <li>Requires the Serialization module</li>
          </ul>
        </section>

        <section>
          <h3>Modeling REST data as entities</h3>
          <ul>
            <li>Create custom entity representing REST data</li>
            <li>Inject the 'serializer' service</li>
            <li>Deserialize the REST data into an entity</li>
          </ul>
          <pre><code class="hljs">
 $data = $this->httpClient->get('https://www.drupal.org/api-d7/node/2692565.json');
 $serializer = \Drupal::service('serializer');
 $entity = $serializer->deserialize($data, 'Drupal\change_records\Entity\ChangeRecord', 'json');
          </code></pre>
        </section>

        <section>
          <h2>Providing a REST API in Drupal</h2>
          <ul>
            <li>Why use Drupal?</li>
            <li>Designing a REST API</li>
            <li>REST modules</li>
            <li>Programmatically creating endpoints</li>
            <li>Headless Drupal</li>
          </ul>
        </section>

        <section>
          <h2>Why use Drupal?</h2>
          <ul>
            <li>No need to write custom code</li>
            <li>Powerful data modeling UI</li>
            <li>Versioning</li>
            <li>Caching</li>
            <li>Pagination</li>
            <li>Flood control</li>
            <li>Sorting</li>
            <li>Filtering</li>
            <li>Awesome content authoring tools</li>
          </ul>
        </section>

        <section>
          <h2>Designing a REST API</h2>
          <ul>
            <li><code class="inline-code">GET /api/v1/books</code> - Lists books</li>
            <li><code class="inline-code">GET /api/v1/books/123</code> - Retrieve a book</li>
            <li><code class="inline-code">POST /api/v1/books</code> - Create a book</li>
            <li><code class="inline-code">PATCH /api/v1/books/123</code> - Update a book</li>
            <li><code class="inline-code">DELETE /api/v1/books/123</code> - Delete a book</li>
          </ul>
        </section>

        <section>
          <h2>Designing a REST API</h2>
          <ul>
            <li><code class="inline-code">GET /api/v1/books/123/chapters</code> - Lists chapters</li>
            <li><code class="inline-code">GET /api/v1/books/123/chapters/456</code> - Retrieve a chapter</li>
            <li><code class="inline-code">POST /api/v1/books/123/chapters</code> - Create a chapter</li>
            <li><code class="inline-code">PATCH /api/v1/books/123/chapters/456</code> - Update a chapter</li>
            <li><code class="inline-code">DELETE /api/v1/books/123/chapters/456</code> - Delete a chapter</li>
          </ul>
        </section>

        <section>
          <h2>REST related modules</h2>
          <ul>
            <li>RESTful Web Services</li>
            <li>REST UI</li>
            <li>HAL</li>
            <li>HTTP Basic Authentication</li>
            <li>Views</li>
          </ul>
        </section>


        <section>
          <h2>RESTful Web Services module</h2>
          <ul>
            <li>Part of Drupal 8 core</li>
            <li>Depends on Serialization</li>
            <li>No user interface</li>
            <li>Only nodes exposed by default</li>
            <li>Pluggable formats (JSON, XML, ...)</li>
            <li>Flexible authentication methods</li>
            <li>Resource plugin type</li>
            <li>Views plugins</li>
            <li>Hooks to alter resources and URIs</li>
          </ul>
        </section>

        <section>
          <h2>REST UI module</h2>
          <ul>
            <li>User interface for the REST module</li>
            <li>Supports all content entities</li>
            <li>Configure supported data formats</li>
            <li>Configure authentication methods</li>
            <li>Configure HTTP methods</li>
            <li>Optional alternative to raw config</li>
          </ul>
        </section>

        <section>
          <h3>Using REST UI</h3>
          <p>/admin/config/services/rest</p>
          <p><img src="restui.png" /></p>
        </section>

        <section>
          <h3>Permissions</h3>
          <ul>
            <li>Available for every enabled entity</li>
            <li>Separate permission per HTTP method</li>
          </ul>
          <p><img src="permissions.png" /></p>
        </section>

        <section>
          <h2>HAL module</h2>
          <ul>
            <li>Adds support for <a href="https://en.wikipedia.org/wiki/Hypertext_Application_Language">Hypertext Application Language</a></li>
            <li>Adds formats "application/hal+json" &amp; "application/hal+xml"</li>
            <li>Provides location of itself and relations (_links)</li>
            <li>Describes embedded resources (_embedded)</li>
          </ul>
        </section>

        <section>
          <h3>HAL Links</h3>
          <p>Always provide a link to yourself with <code class="inline-code">_self</code></p>
          <pre><code class="hljs">
    {
        "_links": {
            "self": {
                "href": "http://my.domain/users?page=3"
            }
        }
    }
          </code></pre>
        </section>

        <section>
          <h3>HAL Links</h3>
          <p>Paging</p>
          <pre><code class="hljs">
    {
        "_links": {
            "first": {
                "href": "http://my.domain/users"
            },
            "prev": {
                "href": "http://my.domain/users?page=2"
            },
            "next": {
                "href": "http://my.domain/users?page=4"
            },
            "last": {
                "href": "http://my.domain/users?page=133"
            }
        }
    }
          </code></pre>
        </section>

        <section>
          <h3>HAL Embedded Resources</h3>
          <pre><code class="hljs">
    {
        "_embedded": {
            "profile_pictures": [
                {
                    "_links": {
                        "self": {
                            "href": "http://my.domain/files/123"
                        }
                    },
                }
            ],
        }
    }
          </code></pre>
        </section>

        <section>
          <h2>HTTP Basic Authentication</h2>
          <ul>
            <li>Small core module</li>
            <li>Allows to authenticate over HTTP Basic Auth</li>
            <li><code class="inline-code">Authorization: Basic dXNlcjpwYXNz</code></li>
            <li>Credentials are base 64 encoded: only use over HTTPS!</li>
          </ul>
        </section>

        <section>
          <h2>Headless Drupal</h2>
          <ul>
            <li>Using Drupal as a web service</li>
            <li>Decoupling of editing and displaying content</li>
            <li>Frontend implemented separately</li>
            <li>Pull data over RESTful API</li>
          </ul>
        </section>

        <section>
          <h2>Why go headless?</h2>
          <ul>
            <li>Frontend changes faster than backend</li>
            <li>Front end devs prefer JS</li>
            <li>Fast iteration and delivery</li>
            <li>Deliver content to microsites</li>
            <li>Deliver content to any platform</li>
            <li>Broadcasting to multiple targets</li>
            <li>Protect data integrity with REST API</li>
            <li>Provide a rich and powerful CMS</li>
          </ul>
        </section>

        <section>
          <h2>Questions?</h2>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        width: 1280,
        height: 800,

        transition: 'convex', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
